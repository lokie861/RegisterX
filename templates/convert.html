{% extends "base.html" %}
{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='fontawesome/css/all.min.css') }}">
<h2><i class="fas fa-exchange-alt"></i> PLC Register to Modbus Converter</h2>

<div class="converter-wrapper">
  <!-- Input Form -->
  <div class="converter-input">
    <form id="convertForm">
      <label for="plc"><i class="fas fa-microchip"></i> PLC Type:</label>
      <select name="plc" id="plc" required>
        {% for key in plc_keys %}
        <option value="{{ key }}">{{ key }}</option>
        {% endfor %}
      </select>
      
      <label for="address"><i class="fas fa-keyboard"></i> Register Address:</label>
      <input type="text" id="address" name="address" placeholder="e.g. M2401" required>

      <button type="submit"><i class="fas fa-calculator"></i> Convert</button>
    </form>
  </div>

  <!-- Results -->
  <div class="converter-output">
    <div class="result">
      <h3><i class="fas fa-list-alt"></i> Results</h3>
      <p><strong>Raw Modbus Address:</strong> <span id="raw">-</span>
        <button class="copy-btn" onclick="copyToClipboard('raw')"><i class="fas fa-copy"></i></button>
      </p>
      <p><strong>Converted Value:</strong> <span id="converted">-</span>
        <button class="copy-btn" onclick="copyToClipboard('converted')"><i class="fas fa-copy"></i></button>
      </p>
    </div>
  </div>
</div>

<script>
document.getElementById("convertForm").addEventListener("submit", function(e) {
    e.preventDefault(); // stop normal form submission

    let plc = document.getElementById("plc").value;
    let address = document.getElementById("address").value;

    fetch(`api/convert?plc=${encodeURIComponent(plc)}&address=${encodeURIComponent(address)}`)
      .then(response => response.json())
      .then(data => {
          document.getElementById("raw").innerText = data.raw;
          document.getElementById("converted").innerText = data.converted;
      })
      .catch(err => {
          alert("Error: " + err);
      });
});
</script>
{% endblock %}
