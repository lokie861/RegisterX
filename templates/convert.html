{% extends "base.html" %}

{% block content %}
<!-- Notification (hidden by default) -->
<div id="notification" class="notification"></div>

<head>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/convert.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='fontawesome/css/all.min.css') }}">

</head>

<section class="converter">
  <!-- Input Section -->
  <div class="input-section">
    <h2>Details</h2>
    <form id="convertForm">
        <label for="plc_make"><i class="fa-brands fa-bandcamp"></i> PLC Make:</label>
        <select name="plc_make" id="plc_make" required>
          {% for make in plc_make %}
            <option value="{{ make }}">{{ make }}</option>
          {% endfor %}
        </select>
      <label for="plc"><i class="fas fa-microchip"></i> PLC Type:</label>
        <select name="plc" id="plc" required></select>

        <label for="reg_type"><i class="fas fa-cube"></i> Address Type:</label>
        <select name="reg_type" id="reg_type" required>
          <option value="bit">Bit</option>
          <option value="word">Word</option>
        </select>

        <label for="address"><i class="fas fa-keyboard"></i> Register Address:</label>
        <input type="text" id="address" name="address" placeholder="e.g. M2401" required>

      <button type="submit" class="btn-primary">Convert</button>
    </form>
  </div>

  <!-- Output Section -->
  <div class="output-section">
    <h2>Result</h2>
    <div class="output-box">
        <div class="output-item">
          <label>Raw Address:</label>
          <div class="output-value">
            <span id="raw-address"></span>
            <button onclick="copyToClipboard('raw-address')" class="copy-btn">Copy</button>
          </div>
        </div>
        <div class="output-item">
          <label>Modbus Address:</label>
          <div class="output-value">
            <span id="modbus-address"></span>
            <button onclick="copyToClipboard('modbus-address')" class="copy-btn">Copy</button>
          </div>
        </div>
    </div>
  </div>
</section>

<script src="{{ url_for('static', filename='js/convert.js') }}"></script>
<script>
    const plcMappings = {{ plc_mappings | tojson }};
    const plcMakeSelect = document.getElementById("plc_make");
    const plcTypeSelect = document.getElementById("plc");
    
// Populate types based on make
function populatePLCTypes() {
    const selectedMake = plcMakeSelect.value;
    const types = plcMappings[selectedMake] || [];
    plcTypeSelect.innerHTML = "";
    const placeholder = document.createElement("option");
    placeholder.value = "";
    placeholder.textContent = "-- Select PLC Type --";
    placeholder.disabled = true;
    placeholder.selected = true;
    plcTypeSelect.appendChild(placeholder);
    types.forEach(type => {
      const option = document.createElement("option");
      option.value = type;
      option.textContent = type;
      plcTypeSelect.appendChild(option);
    });
  }

  plcMakeSelect.addEventListener("change", populatePLCTypes);

  populatePLCTypes();

</script>

{% endblock %}
